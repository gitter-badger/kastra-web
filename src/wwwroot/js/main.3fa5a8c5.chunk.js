(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,a,t){e.exports=t(15)},15:function(e,a,t){"use strict";t.r(a);var s=t(0),n=t.n(s),i=t(9),r=t.n(i),c=t(2),l=t(3),o=t(6),h=t(4),d=t(5),m=t(7),u=t(1),b=function(e){return n.a.createElement("div",{className:"field"},n.a.createElement("label",{className:"field-checkbox",htmlFor:"".concat(e.name,"-").concat(e.value)},e.title,n.a.createElement("input",{id:"".concat(e.name,"-").concat(e.value),name:e.name,type:"checkbox",value:e.value,checked:e.checked,onChange:e.handleChange}),n.a.createElement("span",{className:"checkmark"})))},g=function(e){return n.a.createElement("div",{className:"field"},n.a.createElement("label",{htmlFor:e.name},e.title),n.a.createElement("input",{id:e.name,type:e.type,name:e.name,value:e.value,onChange:e.handleChange}))},p=function(e){var a;return void 0===(a=void 0!==e.messages&&e.messages.length>0?n.a.createElement("ul",null,e.messages.map(function(e,a){return n.a.createElement("li",{key:a},e)})):e.message)||null===a||0===a.length?null:n.a.createElement("div",{className:"text-danger validation-summary-errors"},a)},v=function(e){function a(e){var t;return Object(c.a)(this,a),(t=Object(o.a)(this,Object(h.a)(a).call(this,e))).handleChange=t.handleChange.bind(Object(u.a)(Object(u.a)(t))),t.handleSubmit=t.handleSubmit.bind(Object(u.a)(Object(u.a)(t))),t.state={databaseServer:"",databaseName:"",integratedSecurity:!1,databaseLogin:"",databasePassword:"",errors:[]},t}return Object(d.a)(a,e),Object(l.a)(a,[{key:"handleChange",value:function(e){var a,t=e.target,s="checkbox"===t.type?t.checked:t.value,n=t.name;this.setState((a={},Object(m.a)(a,n,s),Object(m.a)(a,"displaySuccess",!1),a))}},{key:"handleSubmit",value:function(e){var a=this;e.preventDefault();var t=[];if(0===this.state.databaseServer.length&&t.push("Database server can't be empty"),0===this.state.databaseName.length&&t.push("Database name can't be empty"),this.state.integratedSecurity||(0===this.state.databaseLogin.length&&t.push("Database login can't be empty"),0===this.state.databasePassword.length&&t.push("Database password can't be empty")),t.length>0)this.setState({errors:t});else{this.props.setLoading(!0,"Saving database ...");var s={};s.databaseServer=this.state.databaseServer,s.databaseName=this.state.databaseName,s.databaseLogin=this.state.databaseLogin,s.databasePassword=this.state.databasePassword,s.integratedSecurity=this.state.integratedSecurity,fetch("/install/database/",{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(e){return e.ok||e.json().then(function(e){t.push(e),a.setState({errors:t},function(){a.props.setLoading(!1,"")})}),e.json()}).then(function(e){a.props.checkDatabase()}).catch(function(e){console.log("Error: \n",e.message)})}}},{key:"renderCredentials",value:function(){if(!this.state.integratedSecurity)return n.a.createElement("div",null,n.a.createElement(g,{type:"text",name:"databaseLogin",title:"Database login",value:this.state.password,handleChange:this.handleChange}),n.a.createElement(g,{type:"password",name:"databasePassword",title:"Database password",value:this.state.password,handleChange:this.handleChange}))}},{key:"render",value:function(){return this.props.display?n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement(p,{messages:this.state.errors}),n.a.createElement(g,{type:"text",name:"databaseServer",title:"Database server",value:this.state.email,handleChange:this.handleChange}),n.a.createElement(g,{type:"text",name:"databaseName",title:"Database name",value:this.state.email,handleChange:this.handleChange}),n.a.createElement(b,{name:"integratedSecurity",title:"Integrated security",checked:this.state.integratedSecurity,handleChange:this.handleChange}),this.renderCredentials(),n.a.createElement("div",{className:"actions"},n.a.createElement("button",{type:"submit",className:"button button-primary"},"Validate"))):null}}]),a}(s.Component),f=function(e){function a(e){var t;return Object(c.a)(this,a),(t=Object(o.a)(this,Object(h.a)(a).call(this,e))).handleChange=t.handleChange.bind(Object(u.a)(Object(u.a)(t))),t.handleSubmit=t.handleSubmit.bind(Object(u.a)(Object(u.a)(t))),t.state={email:"",password:"",confirmPassword:"",errors:[]},t}return Object(d.a)(a,e),Object(l.a)(a,[{key:"handleChange",value:function(e){var a,t=e.target,s="checkbox"===t.type?t.checked:t.value,n=t.name;this.setState((a={},Object(m.a)(a,n,s),Object(m.a)(a,"displaySuccess",!1),a))}},{key:"handleSubmit",value:function(e){var a=this;e.preventDefault();var t=[];if(0===this.state.email.length&&t.push("Email can't be empty"),0===this.state.password.length&&t.push("Password can't be empty"),this.state.password!==this.state.confirmPassword&&t.push("Password fields must be equal"),t.length>0)this.setState({errors:t});else{this.props.setLoading(!0,"Creating account ...");var s={};s.email=this.state.email,s.password=this.state.password,s.confirmPassword=this.state.confirmPassword,fetch("/install/account",{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(e){return e.ok||e.json().then(function(e){if(Array.isArray(e))for(var s=0;s<e.length;s++)t.push(e[s].description);else t.push(e);a.setState({errors:t},function(){a.props.setLoading(!1,"")})}),e}).then(function(){document.location.href="/"}).catch(function(e){console.log("Error: \n",e.message)})}}},{key:"render",value:function(){return this.props.display?n.a.createElement("form",{onSubmit:this.handleSubmit},n.a.createElement(p,{messages:this.state.errors}),n.a.createElement(g,{type:"text",name:"email",title:"Email",value:this.state.email,handleChange:this.handleChange}),n.a.createElement(g,{type:"password",name:"password",title:"Password",value:this.state.password,handleChange:this.handleChange}),n.a.createElement(g,{type:"password",name:"confirmPassword",title:"Confirm password",value:this.state.confirmPassword,handleChange:this.handleChange}),n.a.createElement("div",{className:"actions"},n.a.createElement("button",{type:"submit",className:"button button-primary"},"Install"))):null}}]),a}(s.Component),y=function(e){return e.isLoading?n.a.createElement("div",{className:"loader-component"},n.a.createElement("div",{className:"loader-content"},n.a.createElement("div",{className:"loader"},n.a.createElement("div",{className:"inner one"}),n.a.createElement("div",{className:"inner two"}),n.a.createElement("div",{className:"inner three"})),n.a.createElement("p",{className:"message"},e.message))):null},E=function(e){function a(){var e;return Object(c.a)(this,a),(e=Object(o.a)(this,Object(h.a)(a).call(this))).state={databaseExists:!1,accountCreateMode:!1,isLoading:!1,message:!1},e}return Object(d.a)(a,e),Object(l.a)(a,[{key:"componentDidMount",value:function(){this.checkDatabase()}},{key:"checkDatabase",value:function(){var e=this;this.setState({isLoading:!0,message:"Checking database..."}),fetch("/install/checkdatabase",{method:"GET"}).then(function(a){a.ok?(e.setState({isLoading:!1,databaseExists:!0}),e.checkDatabaseTables()):e.setState({isLoading:!1,databaseExists:!1})}).catch(function(e){this.setState({isLoading:!1,databaseExists:!1})})}},{key:"checkDatabaseTables",value:function(){var e=this;this.setState({isLoading:!0,message:"Checking database tables..."}),fetch("/install/checkdatabasetables",{method:"GET"}).then(function(a){a.ok?e.setState({isLoading:!1,accountCreateMode:!1}):e.setState({isLoading:!1,accountCreateMode:!0})}).catch(function(e){console.log(e)})}},{key:"setLoading",value:function(e,a){this.setState({isLoading:e,message:a})}},{key:"render",value:function(){var e=this,a=this.state.isLoading;return n.a.createElement("div",null,n.a.createElement("h2",{className:"title"},"Kastra - Installation"),n.a.createElement("hr",null),n.a.createElement("h3",{className:"subtitle"},"Configure your website."),n.a.createElement(y,{isLoading:this.state.isLoading,message:this.state.message}),n.a.createElement(v,{display:!a&&!this.state.databaseExists,checkDatabase:function(){return e.checkDatabase()},setLoading:function(a,t){return e.setLoading(a,t)}}),n.a.createElement(f,{display:!a&&this.state.databaseExists&&this.state.accountCreateMode,setLoading:function(a,t){return e.setLoading(a,t)}}))}}]),a}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(E,null),document.getElementsByClassName("content")[0]),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[10,2,1]]]);
//# sourceMappingURL=main.3fa5a8c5.chunk.js.map